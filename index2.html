<!DOCTYPE html>
<html>

<head>
  <title>Простой навигатор для пешехода</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
  <style>
    #map {
      width: 800px;
      height: 400px;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/lrm-routing-machine.js"></script>
  <script>
    window.onload = function() {
      function initMap() {
        const map = L.map('map').setView([50.4501, 30.5234], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        const marker = L.marker([50.4501, 30.5234]).addTo(map).bindPopup("Точка отправления");

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            const {
              latitude,
              longitude
            } = position.coords;
            map.setView([latitude, longitude], 15);
            const userMarker = L.marker([latitude, longitude]).addTo(map).bindPopup("Ваше местоположение");

            // Function to calculate and display route from current location to a clicked point
            function calculateRouteToClickedPoint(e) {
              const waypoint = {
                latLng: e.latlng
              };
              const routeControl = L.Routing.control({
                waypoints: [
                  L.latLng(latitude, longitude), // Starting point
                  L.latLng(waypoint.latLng.lat, waypoint.latLng.lng) // Clicked point
                ],
                routeWhileDragging: true,
                createMarker: function(i, waypoint, n) {
                  if (i === n - 1) {
                    return L.marker(waypoint.latLng, {
                      draggable: true
                    }).bindPopup("Конечная точка маршрута");
                  } else {
                    return L.marker(waypoint.latLng).bindPopup("Промежуточная точка маршрута");
                  }
                }
              }).addTo(map);
            }

            // Event listener for clicking on the map to calculate route to clicked point
            map.on('click', calculateRouteToClickedPoint);
          });
        }
      }

      // Вызов функции инициализации карты
      initMap();
    };
  </script>
</body>

</html>
