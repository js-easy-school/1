<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Scalper: DeepSeek V3.2</title>
    <style>
        :root {
            --bg-color: #0d1117;
            --card-bg: #161b22;
            --text-main: #c9d1d9;
            --accent-green: #238636;
            --accent-red: #da3633;
            --accent-blue: #58a6ff;
            --accent-gold: #d29922;
            --border: #30363d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 10px;
            padding-bottom: 80px;
        }

        h1 {
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 15px;
            color: var(--accent-blue);
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        /* Settings Panel */
        .settings-box {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .input-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 0.75rem;
            margin-bottom: 5px;
            color: #8b949e;
            text-transform: uppercase;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: #010409;
            color: white;
            box-sizing: border-box;
            font-size: 1rem;
            outline: none;
            transition: border 0.2s;
        }
        
        select:focus, input:focus {
            border-color: var(--accent-blue);
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
        }

        button:active { transform: scale(0.96); opacity: 0.8; }

        .btn-start { 
            background: linear-gradient(180deg, #2ea043 0%, #238636 100%);
            color: white; 
            box-shadow: 0 2px 0 rgba(0,0,0,0.3);
        }
        
        .btn-stop { 
            background: linear-gradient(180deg, #da3633 0%, #b62324 100%);
            color: white;
            box-shadow: 0 2px 0 rgba(0,0,0,0.3);
        }
        
        /* Timer */
        .timer-display {
            text-align: center;
            font-size: 0.9rem;
            margin-top: 12px;
            color: var(--accent-gold);
            font-family: monospace;
            font-weight: bold;
        }

        /* Trading Cards */
        .grid-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            position: relative;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        .asset-name {
            font-weight: bold;
            font-size: 1.1rem;
            color: #fff;
        }
        
        .asset-desc {
            display: block;
            font-size: 0.75rem;
            color: #8b949e;
            margin-top: 2px;
        }

        .asset-time {
            font-size: 0.75rem;
            color: #8b949e;
            font-family: monospace;
        }

        .recommendation {
            font-size: 1.4rem;
            font-weight: 900;
            margin: 12px 0;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rec-buy { background: rgba(35, 134, 54, 0.15); color: #3fb950; border: 1px solid rgba(35, 134, 54, 0.4); }
        .rec-sell { background: rgba(218, 54, 51, 0.15); color: #f85149; border: 1px solid rgba(218, 54, 51, 0.4); }
        .rec-wait { background: rgba(139, 148, 158, 0.15); color: #c9d1d9; border: 1px solid rgba(48, 54, 61, 0.5); }

        .reasoning {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #c9d1d9;
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 8px;
        }

        .levels-box {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-family: monospace;
            font-size: 1rem;
            font-weight: bold;
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 6px;
        }
        
        .level-stop { color: #ff7b72; }
        .level-take { color: #3fb950; }

        /* Loader */
        .loader {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--accent-blue);
            font-weight: bold;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .footer-note {
            text-align: center;
            font-size: 0.7rem;
            color: #484f58;
            margin-top: 30px;
            padding: 10px;
            border-top: 1px solid var(--border);
        }
    </style>
</head>
<body>

    <h1>üöÄ DeepSeek V3.2 Scalper</h1>

    <div class="settings-box">
        <div class="input-group">
            <label for="apiKey">OpenRouter API Key:</label>
            <input type="password" id="apiKey" placeholder="–í—Å—Ç–∞–≤—å –∫–ª—é—á sk-or-v1-..." autocomplete="off">
        </div>
        <div class="input-group">
            <label for="modelSelect">–ú–æ–¥–µ–ª—å –ò–ò (–û–±–Ω–æ–≤–ª–µ–Ω–æ 2026):</label>
            <select id="modelSelect">
                <option value="deepseek/deepseek-v3.2" selected>DeepSeek V3.2 (–û–±—ã—á–Ω–∞—è / –ë—ã—Å—Ç—Ä–∞—è)</option>
                <option value="deepseek/deepseek-r1">DeepSeek R1 (–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è / –õ–æ–≥–∏–∫–∞)</option>
                <option value="deepseek/deepseek-chat">DeepSeek V3 (–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)</option>
            </select>
        </div>
        <div class="controls">
            <button class="btn-start" onclick="startBot()">–ó–ê–ü–£–°–ö (5 –º–∏–Ω)</button>
            <button class="btn-stop" onclick="stopBot()">–°–¢–û–ü</button>
        </div>
        <div class="timer-display" id="timerStatus">üî¥ –û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</div>
    </div>

    <div id="loader" class="loader">
        üì° –°–ø—Ä–∞—à–∏–≤–∞—é —É DeepSeek...<br>
        <span style="font-size:0.8rem; font-weight:normal; color:#8b949e">–ê–Ω–∞–ª–∏–∑ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —É—Ä–æ–≤–Ω–µ–π...</span>
    </div>

    <div class="grid-container" id="cardsContainer">
        </div>
    
    <div class="footer-note">
        ‚ö†Ô∏è <strong>–†–∏—Å–∫-–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:</strong> –ò–ò –Ω–µ –≤–∏–¥–∏—Ç —Å—Ç–∞–∫–∞–Ω (Order Book) –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. <br>
        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ —Å–∏–≥–Ω–∞–ª—ã —Ç–æ–ª—å–∫–æ –∫–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–≤–æ–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
    </div>

    <script>
        // --- CONFIGURATION ---
        // –¢–æ—á–Ω—ã–µ –∫–æ–¥—ã —Ñ—å—é—á–µ—Ä—Å–æ–≤ –Ω–∞ –ú–∞—Ä—Ç 2026
        const INSTRUMENTS = [
            { id: 'SBRF-3.26', name: '–°–±–µ—Ä–±–∞–Ω–∫', code: 'SRH6', desc: '–§—å—é—á–µ—Ä—Å –Ω–∞ –∞–∫—Ü–∏–∏ –°–±–µ—Ä–∞' },
            { id: 'Si-3.26', name: '–î–æ–ª–ª–∞—Ä/–†—É–±–ª—å', code: 'SiH6', desc: '–•–µ–¥–∂ –≤–∞–ª—é—Ç–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤' },
            { id: 'CR-3.26', name: '–Æ–∞–Ω—å/–†—É–±–ª—å', code: 'CRH6', desc: '–û—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞' },
            { id: 'SILV-3.26', name: '–°–µ—Ä–µ–±—Ä–æ', code: 'SVH6', desc: '–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –º–µ—Ç–∞–ª–ª' },
            { id: 'MIX-3.26', name: '–ò–Ω–¥–µ–∫—Å MOEX', code: 'MXH6', desc: '–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞' }
        ];

        let timerInterval;
        let countdownInterval;
        let isRunning = false;
        const UPDATE_INTERVAL_MS = 300000; // 5 –º–∏–Ω—É—Ç

        // --- INIT ---
        window.onload = () => {
            const savedKey = localStorage.getItem('openrouter_key');
            if (savedKey) document.getElementById('apiKey').value = savedKey;
            
            const savedModel = localStorage.getItem('selected_model');
            if (savedModel) document.getElementById('modelSelect').value = savedModel;
            
            renderInitialCards();
        };

        function renderInitialCards() {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            INSTRUMENTS.forEach(inst => {
                container.innerHTML += `
                    <div class="card" id="card-${inst.code}">
                        <div class="card-header">
                            <div>
                                <div class="asset-name">${inst.name}</div>
                                <span class="asset-desc">${inst.code}</span>
                            </div>
                            <span class="asset-time">--:--</span>
                        </div>
                        <div class="recommendation rec-wait">–ì–û–¢–û–í–ù–û–°–¢–¨</div>
                        <div class="reasoning">–û–∂–∏–¥–∞—é –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã...</div>
                    </div>
                `;
            });
        }

        // --- CORE LOGIC ---
        function startBot() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á!');
                return;
            }
            localStorage.setItem('openrouter_key', apiKey);
            localStorage.setItem('selected_model', document.getElementById('modelSelect').value);

            if (isRunning) return;
            isRunning = true;
            
            document.querySelector('.btn-start').style.opacity = '0.5';
            document.querySelector('.btn-start').innerText = '‚è≥ –†–ê–ë–û–¢–ê–Æ...';
            
            fetchRecommendations(); // –°—Ä–∞–∑—É –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å
            
            timerInterval = setInterval(fetchRecommendations, UPDATE_INTERVAL_MS);
        }

        function stopBot() {
            isRunning = false;
            clearInterval(timerInterval);
            clearInterval(countdownInterval);
            document.getElementById('timerStatus').innerText = '‚õî –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            document.querySelector('.btn-start').style.opacity = '1';
            document.querySelector('.btn-start').innerText = '–ó–ê–ü–£–°–ö (5 –º–∏–Ω)';
            document.getElementById('loader').style.display = 'none';
        }

        function startCountdown(duration) {
            clearInterval(countdownInterval);
            let timer = duration;
            const display = document.getElementById('timerStatus');
            
            countdownInterval = setInterval(() => {
                const minutes = parseInt(timer / 60, 10);
                const seconds = parseInt(timer % 60, 10);
                display.innerText = `üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑: ${minutes}:${seconds < 10 ? "0" + seconds : seconds}`;
                
                if (--timer < 0) {
                    clearInterval(countdownInterval);
                    display.innerText = "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...";
                }
            }, 1000);
        }

        // --- API CALL ---
        async function fetchRecommendations() {
            const apiKey = document.getElementById('apiKey').value;
            const model = document.getElementById('modelSelect').value;
            const loader = document.getElementById('loader');
            
            loader.style.display = 'block';
            document.getElementById('timerStatus').innerText = 'ü§ñ AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ–∫...';

            // –ü—Ä–æ–º–ø—Ç –¥–ª—è –ò–ò
            const prompt = `
            –¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–π–¥–µ—Ä –Ω–∞ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –ë–∏—Ä–∂–µ (FORTS).
            –°–µ–π—á–∞—Å: ${new Date().toLocaleTimeString('ru-RU')}.
            
            –¢–≤–æ—è –∑–∞–¥–∞—á–∞: –î–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ —Å–∫–∞–ª—å–ø–∏–Ω–≥-—Å–¥–µ–ª–∫–∏ –Ω–∞ 10 –º–∏–Ω—É—Ç –¥–ª—è —ç—Ç–∏—Ö —Ñ—å—é—á–µ—Ä—Å–æ–≤:
            ${INSTRUMENTS.map(i => `${i.name} (${i.code})`).join(', ')}.
            
            –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ü–µ–Ω–∞—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑, —É—á–∏—Ç—ã–≤–∞—è –≤—Ä–µ–º—è –¥–Ω—è (—É—Ç—Ä–æ/–æ–±–µ–¥/–≤–µ—á–µ—Ä).
            –í–ù–ò–ú–ê–ù–ò–ï: –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON –º–∞—Å—Å–∏–≤, –±–µ–∑ —Ç–µ–∫—Å—Ç–∞.
            
            –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
            [{
                "id": "SRH6",
                "action": "LONG" –∏–ª–∏ "SHORT" –∏–ª–∏ "WAIT",
                "reason": "–ö–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞ (–¥–æ 10 —Å–ª–æ–≤)",
                "sl": "–¶–µ–Ω–∞ SL",
                "tp": "–¶–µ–Ω–∞ TP"
            }, ...]
            `;

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": "https://github.com/toni-investor",
                        "X-Title": "DeepSeekScalper"
                    },
                    body: JSON.stringify({
                        "model": model,
                        "messages": [
                            {"role": "system", "content": "You are a JSON-only trading bot. Output pure JSON without markdown blocks."},
                            {"role": "user", "content": prompt}
                        ],
                        "temperature": 0.6
                    })
                });

                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ API: ' + response.status);

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // –ß–∏—Å—Ç–∏–º –æ—Ç–≤–µ—Ç –æ—Ç –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –º–∞—Ä–∫–¥–∞—É–Ω–∞ (```json ... ```)
                const jsonMatch = content.match(/\[[\s\S]*\]/); 
                
                if (jsonMatch) {
                    const parsedData = JSON.parse(jsonMatch[0]);
                    updateUI(parsedData);
                } else {
                    console.error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON:", content);
                    alert("–ò–ò –≤–µ—Ä–Ω—É–ª —Å—Ç—Ä–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å.");
                }

            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message);
                stopBot();
            } finally {
                loader.style.display = 'none';
                startCountdown(UPDATE_INTERVAL_MS / 1000);
            }
        }

        // --- UI UPDATE ---
        function updateUI(data) {
            data.forEach(item => {
                const card = document.getElementById(`card-${item.id}`);
                if (!card) return;

                let actionClass = 'rec-wait';
                let actionText = '–ù–ê–ë–õ–Æ–î–ï–ù–ò–ï';
                const act = item.action.toUpperCase();

                if (act.includes('LONG') || act.includes('BUY')) {
                    actionClass = 'rec-buy';
                    actionText = '–ü–û–ö–£–ü–ê–¢–¨ üöÄ';
                } else if (act.includes('SHORT') || act.includes('SELL')) {
                    actionClass = 'rec-sell';
                    actionText = '–ü–†–û–î–ê–í–ê–¢–¨ üîª';
                }

                // –ê–Ω–∏–º–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                card.style.opacity = '0.5';
                setTimeout(() => card.style.opacity = '1', 300);

                card.querySelector('.asset-time').innerText = new Date().toLocaleTimeString().slice(0,5);
                const recEl = card.querySelector('.recommendation');
                recEl.className = `recommendation ${actionClass}`;
                recEl.innerText = actionText;
                
                card.querySelector('.reasoning').innerHTML = `
                    ${item.reason}
                    <div class="levels-box">
                        <span class="level-stop">SL: ${item.sl}</span>
                        <span class="level-take">TP: ${item.tp}</span>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
